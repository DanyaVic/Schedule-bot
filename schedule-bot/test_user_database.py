from user_database import UserDatabase


def test_user_database():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å UserDatabase"""

    db = UserDatabase('schedules/test_users.db')

    print("=" * 50)
    print("üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï USER DATABASE")
    print("=" * 50)

    # –¢–µ—Å—Ç 1: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    print("\n –¢–µ—Å—Ç 1: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    result = db.add_user(123456, '09-512 (2)')
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {result}")
    assert result == True, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"

    # –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–∏—Ç—å –≥—Ä—É–ø–ø—É
    print("\n –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–∏—Ç—å –≥—Ä—É–ø–ø—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    group = db.get_user_group(123456)
    print(f"   –ì—Ä—É–ø–ø–∞: {group}")
    assert group == '09-512 (2)', f"–û–∂–∏–¥–∞–ª–∞—Å—å '09-512 (2)', –ø–æ–ª—É—á–µ–Ω–æ '{group}'"

    # –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    print("\n –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    exists = db.user_exists(123456)
    print(f"   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {exists}")
    assert exists == True, "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"

    # –¢–µ—Å—Ç 4: –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    print("\n –¢–µ—Å—Ç 4: –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    user = db.get_user(123456)
    print(f"   –î–∞–Ω–Ω—ã–µ: {user}")
    assert user is not None, "–î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã"
    assert user['group'] == '09-512 (2)', "–ì—Ä—É–ø–ø–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç"
    assert user['notifications'] == True, "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω—ã"

    # –¢–µ—Å—Ç 5: –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    print("\n –¢–µ—Å—Ç 5: –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
    db.add_user(111111, '09-512 (2)')
    db.add_user(222222, '09-513 (1)')
    db.add_user(333333, '09-514 (2)')
    db.add_user(444444, '09-512 (2)')
    print("   –î–æ–±–∞–≤–ª–µ–Ω–æ 4 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")

    # –¢–µ—Å—Ç 6: –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    print("\n –¢–µ—Å—Ç 6: –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
    all_users = db.get_all_users()
    print(f"   –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {len(all_users)}")
    assert len(all_users) == 5, f"–û–∂–∏–¥–∞–ª–æ—Å—å 5 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–æ–ª—É—á–µ–Ω–æ {len(all_users)}"

    # –¢–µ—Å—Ç 7: –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –≥—Ä—É–ø–ø–µ
    print("\n –¢–µ—Å—Ç 7: –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –≥—Ä—É–ø–ø–µ")
    group_users = db.get_users_by_group('09-512 (2)')
    print(f"   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –≥—Ä—É–ø–ø–µ '09-512 (2)': {len(group_users)}")
    print(f"   User IDs: {group_users}")
    assert len(group_users) == 3, f"–û–∂–∏–¥–∞–ª–æ—Å—å 3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø–µ"

    # –¢–µ—Å—Ç 8: –û–±–Ω–æ–≤–∏—Ç—å –≥—Ä—É–ø–ø—É
    print("\n –¢–µ—Å—Ç 8: –û–±–Ω–æ–≤–∏—Ç—å –≥—Ä—É–ø–ø—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    result = db.update_group(123456, '09-515 (1)')
    print(f"   –û–±–Ω–æ–≤–ª–µ–Ω–æ: {result}")
    assert result == True, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≥—Ä—É–ø–ø—ã"
    new_group = db.get_user_group(123456)
    print(f"   –ù–æ–≤–∞—è –≥—Ä—É–ø–ø–∞: {new_group}")
    assert new_group == '09-515 (1)', "–ì—Ä—É–ø–ø–∞ –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞"

    # –¢–µ—Å—Ç 9: –û—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    print("\n –¢–µ—Å—Ç 9: –û—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è")
    result = db.set_notifications(111111, False)
    print(f"   –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã: {result}")
    assert result == True, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"
    user = db.get_user(111111)
    print(f"   –°—Ç–∞—Ç—É—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: {user['notifications']}")
    assert user['notifications'] == False, "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω—ã"

    # –¢–µ—Å—Ç 10: –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    print("\n –¢–µ—Å—Ç 10: –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏")
    notif_users = db.get_users_for_notifications()
    print(f"   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏: {len(notif_users)}")
    print(f"   User IDs: {list(notif_users.keys())}")
    assert len(notif_users) == 4, f"–û–∂–∏–¥–∞–ª–æ—Å—å 4 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏"

    # –¢–µ—Å—Ç 11: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î
    print("\n –¢–µ—Å—Ç 11: –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ë–î")
    stats = db.get_stats()
    print(f"   –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {stats['total_users']}")
    print(f"   –° —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏: {stats['users_with_notifications']}")
    print(f"   –ü–æ –≥—Ä—É–ø–ø–∞–º: {stats['groups']}")
    assert stats['total_users'] == 5, "–ù–µ–≤–µ—Ä–Ω—ã–π —Å—á–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"

    # –¢–µ—Å—Ç 12: –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    print("\n –¢–µ—Å—Ç 12: –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    result = db.delete_user(333333)
    print(f"   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω: {result}")
    assert result == True, "–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
    exists = db.user_exists(333333)
    print(f"   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {exists}")
    assert exists == False, "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –±—ã–ª —É–¥–∞–ª–µ–Ω"

    # –¢–µ—Å—Ç 13: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    print("\n –¢–µ—Å—Ç 13: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    group = db.get_user_group(999999)
    print(f"   –ì—Ä—É–ø–ø–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {group}")
    assert group is None, "–î–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å—Å—è None"

    # –ò—Ç–æ–≥–∏
    print("\n" + "=" * 50)
    print(" –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!")
    print("=" * 50)

    # –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    final_stats = db.get_stats()
    print(f"\n –§–ò–ù–ê–õ–¨–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:")
    print(f"   –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {final_stats['total_users']}")
    print(f"   –° —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏: {final_stats['users_with_notifications']}")
    print(f"   –ü–æ –≥—Ä—É–ø–ø–∞–º: {final_stats['groups']}")


if __name__ == "__main__":
    try:
        test_user_database()
    except AssertionError as e:
        print(f"\n –¢–ï–°–¢ –ù–ï –ü–†–û–®–ï–õ: {e}")
    except Exception as e:
        print(f"\n –û–®–ò–ë–ö–ê: {e}")
        import traceback

        traceback.print_exc()
